# 🎵 Static Music Player

ローカルの音楽ファイルをブラウザで再生するためのシンプルでモダンなWebベースの音楽プレイヤーです。
アルバムアートの自動抽出、Picture-in-Picture（ミニプレイヤー）機能を搭載しています。

## ✨ 主な機能

- 🎨 **アルバムアート自動抽出** - MP3/M4Aファイルから埋め込まれたアルバムアートを自動抽出
- 🎭 **モダンなUI** - グラスモーフィズムデザインの美しいインターフェース
- 🖼️ **PiP（Picture-in-Picture）モード** - 作業しながら使えるミニプレイヤー
- 🔁 **リピート機能** - 全曲リピート / 1曲リピート / リピートなし
- 🔀 **ソート機能** - 昇順 / 降順 / ランダム
- 📱 **レスポンシブ対応** - デスクトップ・モバイル両対応
- 🎵 **対応形式** - MP3, M4A, AAC, OGG, WAV

## 📋 必要要件

- Python 3.6 以上
- ブラウザ（Chrome, Edge, Firefox など）

### オプション

- `mutagen` - アルバムアートを抽出する場合に必要

```bash
pip install mutagen
```

> **注意**: `mutagen` をインストールしない場合、アルバムアートの抽出はスキップされますが、プレイヤー自体は正常に動作します。

## 🚀 使い方

### 1. 基本的な使用方法

```bash
python generate.py <音楽フォルダのパス>
```

### 2. 対話モードで起動

```bash
python generate.py
```

プログラムが音楽フォルダのパスを尋ねてきますので、入力してください。

### 3. 実行例

```bash
# Windowsの場合
python generate.py "C:\Music\MyAlbums"

# macOS/Linuxの場合
python generate.py "/home/user/Music"
```

### 4. 実行後

実行すると、指定したフォルダ内に以下のファイルが生成されます：

- `index.html` - 音楽プレイヤー本体
- `playlist.js` - プレイリストデータ
- `covers/` - 抽出されたアルバムアート画像（フォルダ）

---

生成されるファイル（音楽フォルダ内）:
├── index.html            # プレイヤー本体
├── playlist.js           # プレイリストデータ
└── covers/               # アルバムアート画像
    ├── <hash1>.jpg
    ├── <hash2>.jpg
    └── ...

生成された `index.html` をブラウザで開いて使用してください。

## 🎮 操作方法

### プレイヤー画面

- **再生/一時停止** - 中央の大きな円形ボタン
- **前の曲** - 左矢印ボタン（曲の開始3秒以内なら前の曲、それ以降なら先頭に戻る）
- **次の曲** - 右矢印ボタン
- **リピート** - 🔁 ボタン（3つのモード切替: なし → 全曲 → 1曲）
- **ソート** - ☰ ボタン（3つのモード切替: 昇順 → 降順 → ランダム）
- **ミニプレイヤー** - 📺 ボタン（Picture-in-Picture モード）

### プレイリスト

- 右側パネルに全曲リスト表示
- 曲名をクリックで即座に再生
- 現在再生中の曲はハイライト表示

### 再生モード

- **リピートなし**: プレイリストの末尾で停止します。
- **全曲リピート**: プレイリスト末尾まで再生後、先頭に戻って連続再生します。
- **1曲リピート**: 現在の曲のみを繰り返し再生します。
- **シャッフル**: 曲順をランダムに選択します（トグル式）。
- **ソート**: 曲名で昇順/降順に並べ替えます（ボタンで切替）。

## 🔧 コマンドラインオプション

```bash
python generate.py [フォルダパス] [オプション]
```

### オプション一覧

| オプション | 説明 | デフォルト値 |
|----------|------|------------|
| `--port` | サーバーのポート番号（現在未実装） | 8000 |
| `--no-server` | サーバーを起動しない（現在未実装） | False |

> **注意**: サーバー起動機能は現在のバージョンでは実装されていません。生成された `index.html` を直接ブラウザで開いてください。

## 📁 プロジェクト構成

```
MusicPlayer/
├── generate.py            # メインスクリプト
├── player_template.html   # プレイヤーのHTMLテンプレート
└── README.md              # このファイル

生成されるファイル（音楽フォルダ内）:
├── index.html            # プレイヤー本体
├── playlist.js           # プレイリストデータ
└── covers/               # アルバムアート画像
    ├── <hash1>.jpg
    ├── <hash2>.jpg
    └── ...
```

## 💡 仕様詳細

### アルバムアートの抽出

- `mutagen` ライブラリを使用して音楽ファイルに埋め込まれた画像を抽出
- 画像はMD5ハッシュ値をファイル名として `covers/` フォルダに保存
- 同じファイルの画像は一度だけ抽出（高速化）
- 対応形式: MP3 (ID3タグ), M4A (MP4タグ)

### データ構造

`playlist.js` は以下の形式でプレイリストデータを出力します：

```javascript
const LOCAL_FILES = [
  {
    "name": "曲名.mp3",
    "url": "曲名.mp3",
    "cover": "covers/abc123def456.jpg"
  },
  ...
];
```

### ブラウザ互換性

- **推奨ブラウザ**: Chrome, Edge (Chromium版)
- **Picture-in-Picture機能**: Chrome 116+ または Edge 116+ が必要
- **基本的な再生機能**: すべてのモダンブラウザで動作

## 🐛 トラブルシューティング

### アルバムアートが表示されない

1. `mutagen` がインストールされているか確認
   ```bash
   pip show mutagen
   ```
2. 音楽ファイルに画像が埋め込まれているか確認
3. 再度 `generate.py` を実行して画像を再抽出

### プレイヤーが動作しない

1. ブラウザのコンソール（F12キー）でエラーを確認
2. `playlist.js` が正しく生成されているか確認
3. ファイルパスに特殊文字が含まれていないか確認

### PiPモードが使えない

- Chrome 116以降、またはEdge 116以降を使用してください
- 一部のブラウザでは実験的機能として有効化が必要な場合があります

## 📝 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 🙏 使用技術

- **Python 3** - スクリプト言語
- **mutagen** - 音楽メタデータ抽出
- **HTML5/CSS3/JavaScript** - プレイヤーUI
- **Web Audio API** - 音楽再生
- **Document Picture-in-Picture API** - ミニプレイヤー機能

## 🔄 今後の予定

- [ ] サーバー起動機能の実装
- [ ] プレイリストの保存・読込機能
- [ ] イコライザー機能
- [ ] 検索・フィルター機能
- [ ] FLAC形式のアートワーク抽出対応

---

**開発日**: 2026年1月

問題や改善提案がある場合は、Issueを作成してください。
